@page "/editor"
@using GameModel
@inject IJSRuntime JS

<h3>Game Editor</h3>

<textarea @bind="RawYaml" rows="20" style="width:100%"></textarea>
<br/>
<button @onclick="LoadYaml">Parse YAML</button>
<button @onclick="UpdateYaml">Update YAML</button>
<button @onclick="ExportYaml">Export YAML</button>
<button @onclick="ExportPack">Export Pack</button>

@code {
    private string RawYaml = "";
    private GameData? Data;

    private void LoadYaml()
    {
        Data = YamlHelper.ParseYaml(RawYaml);
    }

    private void UpdateYaml()
    {
        if (Data != null)
            RawYaml = YamlHelper.SerializeYaml(Data);
    }

    private async Task ExportYaml()
    {
        await JS.InvokeVoidAsync("downloadText", RawYaml, "game.yaml");
    }

    private async Task ExportPack()
    {
        if (Data == null) return;
        var bytes = PackBuilder.SerializeAndCompress(Data);
        var base64 = Convert.ToBase64String(bytes);
        await JS.InvokeVoidAsync("downloadPack", base64, "game.pack");
    }
}
